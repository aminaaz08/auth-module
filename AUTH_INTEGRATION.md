# –ú–æ–¥—É–ª—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ ‚Äî –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

–≠—Ç–æ—Ç –º–æ–¥—É–ª—å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç API –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —á–µ—Ä–µ–∑:
- –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–π –∫–æ–¥ (–Ω–∞ email),
- GitHub OAuth,
- –Ø–Ω–¥–µ–∫—ÅID,
- –∫—Ä–æ—Å—Å-–¥–µ–≤–∞–π—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é —á–µ—Ä–µ–∑ –∫–æ–¥ (¬´–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∏–∑ Telegram –≤ Web¬ª).

–í—Å–µ –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ MongoDB, –≤—ã–¥–∞—ë—Ç—Å—è JWT-—Ç–æ–∫–µ–Ω (access + refresh), –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –¥—Ä—É–≥–∏–º —á–∞—Å—Ç—è–º —Å–∏—Å—Ç–µ–º—ã.

---

## –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ

### 1. –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Python 3.9+
- MongoDB (–ª–æ–∫–∞–ª—å–Ω–æ –∏–ª–∏ Atlas)
- –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

### 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞
#### –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π (–µ—Å–ª–∏ –µ—â—ë –Ω–µ —Å–¥–µ–ª–∞–Ω–æ)
```
git clone <https://github.com/aminaaz08/auth-module>
cd auth-module
```
#### –°–æ–∑–¥–∞–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
```
python -m venv venv
source venv/bin/activate      # Linux/Mac
venv\Scripts\activate         # Windows
```
#### –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```
pip install -r requirements.txt
```
### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞
—Ñ–∞–π–ª .env –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

.env
```
# –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
MONGODB_URL=mongodb://localhost:27017
DB_NAME=auth_db
SECRET_KEY=–≤–∞—à_–Ω–∞–¥—ë–∂–Ω—ã–π_—Å–µ–∫—Ä–µ—Ç–Ω—ã–π_–∫–ª—é—á_–¥–ª–∏–Ω–æ–π_–º–∏–Ω–∏–º—É–º_32_—Å–∏–º–≤–æ–ª–∞
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=1440
REFRESH_TOKEN_EXPIRE_DAYS=7

# –î–ª—è GitHub OAuth (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
GITHUB_CLIENT_ID=–≤–∞—à_client_id
GITHUB_CLIENT_SECRET=–≤–∞—à_client_secret

# –î–ª—è –Ø–Ω–¥–µ–∫—ÅID (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
YANDEX_CLIENT_ID=–≤–∞—à_yandex_client_id
YANDEX_CLIENT_SECRET=–≤–∞—à_yandex_client_secret
```
–°–æ–≤–µ—Ç: –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ SECRET_KEY –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
```
import¬†secrets
print(secrets.token_hex(32))
```

### 4. –ó–∞–ø—É—Å–∫
bash
```
uvicorn¬†main:app¬†--reload
```
–°–µ—Ä–≤–µ—Ä –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É:
http://localhost:8000

–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API:
http://localhost:8000/docs

### –î–æ—Å—Ç—É–ø–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

#### * –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ –∫–æ–¥—É
–ó–∞–ø—Ä–æ—Å–∏—Ç—å –∫–æ–¥
POST /auth/code/request
–¢–µ–ª–æ: {"email": "user@example.com"}
‚Üí –ö–æ–¥ –ø–æ—è–≤–∏—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª–∏ —Å–µ—Ä–≤–µ—Ä–∞ (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ ‚Äî –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ email/Telegram).
–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∫–æ–¥
POST /auth/code/verify
–¢–µ–ª–æ: {"email": "user@example.com", "code": "123456"}
‚Üí –í –æ—Ç–≤–µ—Ç–µ: {"access_token": "...", "token_type": "bearer"}

#### * –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ –≤–Ω–µ—à–Ω–∏–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã
POST /auth/init —Å {"provider": "github", "entry_token": "..."} ‚Üí –ø–æ–ª—É—á–∏—Ç—å auth_url,
POST /auth/init —Å {"provider": "yandex", "entry_token": "..."} ‚Üí –ø–æ–ª—É—á–∏—Ç—å auth_url,
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –ø–æ —Å—Å—ã–ª–∫–µ auth_url ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.

#### * –ö—Ä–æ—Å—Å-–¥–µ–≤–∞–π—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ –∫–æ–¥
–≠—Ç–æ—Ç —Å—Ü–µ–Ω–∞—Ä–∏–π –ø–æ–∑–≤–æ–ª—è–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è –Ω–∞ –æ–¥–Ω–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ —á–µ—Ä–µ–∑ –¥—Ä—É–≥–æ–µ.
–®–∞–≥ 1. –ò–Ω–∏—Ü–∏–∞—Ü–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ Telegram)
http
```
POST /auth/init
```
json
```
{
  "provider": "code",
  "entry_token": "telegram_session_123"
}
```
‚Üí –û—Ç–≤–µ—Ç:

json
```
{
  "code": "123456",
  "expires_in": 60
}
```
–®–∞–≥ 2. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ Web)
–°–Ω–∞—á–∞–ª–∞ Web-–∫–ª–∏–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω (–∏–º–µ—Ç—å refresh_token).
–ó–∞—Ç–µ–º:
http
```
POST /auth/code/submit
```
json
```
{
  "code": "123456",
  "refresh_token": "–≤–∞—à_refresh_token_–∏–∑_Web"
}
```
‚Üí –û—Ç–≤–µ—Ç:

json
```
{
  "status": "success",
  "message": "–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞"
}
```
> ‚úÖ –¢–µ–ø–µ—Ä—å Telegram-—Å–µ—Å—Å–∏—è (entry_token) –ø–æ–ª—É—á–∏—Ç –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.


#### * –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
GET /me
–¢—Ä–µ–±—É–µ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫: Authorization: Bearer <–≤–∞—à_—Ç–æ–∫–µ–Ω>
‚Üí –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:

json
```
{
    "id":¬†"65a...",¬†¬†
    "email":¬†"user@example.com",¬†¬†
    "auth_method":¬†"code",¬†// –∏–ª–∏ "github", "yandex"
    "external_id":¬†"email:user@example.com"¬†//¬†–∏–ª–∏¬†"gh_12345"
}
```

#### * –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
POST /auth/refresh ‚Üí –æ–±–Ω–æ–≤–∏—Ç—å access_token –ø–æ refresh_token.

#### *  –ö–∞–∫ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è
#### –î–ª—è Web-–∫–ª–∏–µ–Ω—Ç–∞
##### –°—Ü–µ–Ω–∞—Ä–∏–π A: –ü—Ä–æ—Å—Ç–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
1. –í—ã–∑—ã–≤–∞–π—Ç–µ `/auth/code/request` ‚Üí `/auth/code/verify`.
2. –°–æ—Ö—Ä–∞–Ω—è–π—Ç–µ `access_token` –∏ `refresh_token`.
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `access_token` –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ `Authorization: Bearer ...`.
##### –°—Ü–µ–Ω–∞—Ä–∏–π B: –ö—Ä–æ—Å—Å-–¥–µ–≤–∞–π—Å (Telegram ‚Üí Web)
1. Telegram: –≤—ã–∑—ã–≤–∞–µ—Ç `/auth/init` ‚Üí –ø–æ–ª—É—á–∞–µ—Ç –∫–æ–¥ ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é: ¬´–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ 123456 –≤ Web¬ª.
2. Web: –¥–æ–ª–∂–µ–Ω —É–∂–µ –∏–º–µ—Ç—å `refresh_token`.
3. Web: –≤—ã–∑—ã–≤–∞–µ—Ç `/auth/code/submit` —Å –∫–æ–¥–æ–º –∏ —Å–≤–æ–∏–º `refresh_token`.
4. Telegram: –æ–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Å–µ—Å—Å–∏—é (–∏–ª–∏ –ø–æ–ª—É—á–∞–µ—Ç –≤–µ–±—Ö—É–∫) ‚Üí –ø–æ–ª—É—á–∞–µ—Ç `access_token`.
> üí° –ú–æ–¥—É–ª—å —Å–∞–º —Å–æ–∑–¥–∞—ë—Ç/–Ω–∞—Ö–æ–¥–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –Ω–∞–∑–Ω–∞—á–∞–µ—Ç —Ä–æ–ª—å `["–°—Ç—É–¥–µ–Ω—Ç"]`.

#### –î–ª—è –º–æ–¥—É–ª—è —Ç–µ—Å—Ç–æ–≤
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `user.id` –∏–∑ `/me` –¥–ª—è –ø—Ä–∏–≤—è–∑–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ç–µ—Å—Ç–æ–≤ –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.
- –•—Ä–∞–Ω–∏—Ç–µ `external_id`, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ —Ä–∞–∑–ª–∏—á–∞—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫–∏ (`email`, `GitHub`, `–Ø–Ω–¥–µ–∫—Å`).

#### *  –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```
auth-module/
‚îú‚îÄ‚îÄ main.py              # —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îú‚îÄ‚îÄ .env                 # –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ .env.example         # –ø—Ä–∏–º–µ—Ä –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è –∫–æ–º–∞–Ω–¥—ã
‚îú‚îÄ‚îÄ requirements.txt     # –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ AUTH_INTEGRATION.md  # —ç—Ç–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
‚îî‚îÄ‚îÄ auth/
    ‚îú‚îÄ‚îÄ _init__.py       # –ü—É—Å—Ç–æ–π —Ñ–∞–π–ª –¥–ª—è –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –º–æ–¥—É–ª–µ–π –∏–∑ —ç—Ç–æ–π –ø–∞–ø–∫–∏
    ‚îú‚îÄ‚îÄ db.py            # –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ MongoDB
    ‚îú‚îÄ‚îÄ models.py        # Pydantic-–º–æ–¥–µ–ª–∏
    ‚îî‚îÄ‚îÄ routes.py        # –≤—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
```
